# Story 1.2: User Login

## Status: Ready for Dev

## Story

As a registered user,
I want to log in with my email and password,
So that I can securely access my personal expense tracking account.

## Acceptance Criteria

1. **AC1: Login Form** - User can log in with registered email and password
2. **AC2: Session Maintenance** - System maintains secure session after successful login
3. **AC3: Invalid Credentials Handling** - System displays appropriate error for invalid credentials
4. **AC4: Successful Redirect** - Login redirects to dashboard after successful authentication
5. **AC5: Session Persistence (Default)** - Sessions last 7 days by default (Supabase default)

**MVP Scope:** Basic session management only. No "Remember Me" checkbox required for MVP (Phase 2).

## Dev Notes

### Technical Context

#### Authentication Architecture
- **Provider:** Supabase Auth (Email/Password) [Source: architecture/tech-stack.md]
- **Session:** Managed via `supabase-js` client and Next.js Middleware for route protection.
- **Tokens:** JWT stored in secure httpOnly cookies (handled by Supabase helpers for Next.js).

#### Frontend Implementation
- **Page:** `/login/page.tsx` (App Router)
- **Form:** React Hook Form + Zod validation.
- **UI:** Card layout centered on screen.
- **Components:** Reuse Input/Button components from Story 1.1 if available.

#### Security
- **Protection:** Redirect unauthenticated users from protected routes to `/login`.
- **Redirects:** Redirect authenticated users from `/login` to `/dashboard`.

#### Testing Requirements
- **Unit:** Test form validation (required fields).
- **Integration:** Mock Supabase response for success/failure.
- **E2E:** Full login flow → Redirect to Dashboard.

### Integration Approach
- Use `supabase.auth.signInWithPassword({ email, password })`.
- Handle errors: `Invalid login credentials` should be shown as "Invalid email or password" (generic security practice).

## Tasks / Subtasks

- [ ] **Task 1: Create Login Page**
  - [ ] Create `/app/login/page.tsx`
  - [ ] Implement form UI (Email, Password)
  - [ ] Implement Zod schema validation

- [ ] **Task 2: Implement Login Logic**
  - [ ] Hook up `signInWithPassword`
  - [ ] Handle Loading state
  - [ ] Handle Error state (Invalid credentials)

- [ ] **Task 3: Implement Auth Middleware**
  - [ ] Create/Update `middleware.ts` to protect private routes (dashboard)
  - [ ] Redirect authenticated users away from /login

- [ ] **Task 4: Testing**
  - [ ] Unit tests for validation
  - [ ] E2E test for successful login

## Success Criteria
✅ User can log in with valid credentials
✅ Invalid credentials show error
✅ Protected routes require login
✅ Login persists on refresh (within 7 days)
